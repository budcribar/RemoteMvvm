<?xml version="1.0" encoding="utf-8"?>
<Project>
	<!-- 1) Make the custom item known -->
	<ItemGroup>
		<AvailableItemName Include="MvvmViewModelProtoSource" />
	</ItemGroup>

	<!-- 2) Pick out the single PackageReference whose Identity matches our generator -->
	<ItemGroup>
		<_FilteredSourceGenPkg
		  Include="@(PackageReference)"
		  Condition=" '%(Identity)' == 'PeakSWC.MvvmSourceGenerator' " />
	</ItemGroup>

	<!-- 3) Snap its GrpcServices metadata into a temporary property -->
	<PropertyGroup>
		<!-- this will be empty if no matching PackageReference was found -->
		<_RawGrpcServices>%(FilteredSourceGenPkg.GrpcServices)</_RawGrpcServices>
	</PropertyGroup>

	<!-- 4) Only now assign the real $(GrpcServices) if not already set -->
	<PropertyGroup Condition="
      '$(GrpcServices)' == '' and
      '$(_RawGrpcServices)' != '' ">
		<!-- strip any stray whitespace -->
		<GrpcServices>
			$([System.Text.RegularExpressions.Regex]::Replace('$(_RawGrpcServices)', '\s+', ''))
		</GrpcServices>
	</PropertyGroup>

	<!-- 5) (optional) debug message -->
	<Message
	  Condition="'$(GrpcServices)' != ''"
	  Importance="High"
	  Text="GrpcServices is now: '$(GrpcServices)'" />
</Project>
