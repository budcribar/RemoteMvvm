// <auto-generated>
// Generated by RemoteMvvmTool.
// </auto-generated>

import { HP3LSThermalTestViewModelServiceClient } from './generated/HP3LSThermalTestViewModelServiceClientPb';
import { HP3LSThermalTestViewModelRemoteClient } from './HP3LSThermalTestViewModelRemoteClient';

const grpcHost = 'http://localhost:50052';
const grpcClient = new HP3LSThermalTestViewModelServiceClient(grpcHost);
const vm = new HP3LSThermalTestViewModelRemoteClient(grpcClient);

// Centralized error reporting
function handleError(err: any, context?: string) {
    try {
        const msg = err?.message ?? String(err);
        console.error(context ? `${context}:` : 'Error:', err);
        const statusEl = document.getElementById('connection-status');
        if (statusEl) {
            statusEl.textContent = context ? `${context}: ${msg}` : msg;
        }
    } catch { /* no-op */ }
}


async function render() {
    (document.getElementById('cpuTemperatureThreshold') as HTMLInputElement).value = JSON.stringify(vm.cpuTemperatureThreshold);
    (document.getElementById('cpuLoadThreshold') as HTMLInputElement).value = JSON.stringify(vm.cpuLoadThreshold);
    (document.getElementById('cpuLoadTimeSpan') as HTMLInputElement).value = JSON.stringify(vm.cpuLoadTimeSpan);
    (document.getElementById('zoneList') as HTMLInputElement).value = JSON.stringify(vm.zoneList);
    (document.getElementById('testSettings') as HTMLInputElement).value = JSON.stringify(vm.testSettings);
    (document.getElementById('showDescription') as HTMLInputElement).value = JSON.stringify(vm.showDescription);
    (document.getElementById('showReadme') as HTMLInputElement).value = JSON.stringify(vm.showReadme);
    (document.getElementById('connection-status') as HTMLElement).textContent = vm.connectionStatus;
}

async function init() {
    try {
        await vm.initializeRemote();
        vm.addChangeListener(render);
        await render();
    } catch (err) {
        handleError(err, 'Initialize remote');
    }
}

document.addEventListener('DOMContentLoaded', () => {
    init();
    (document.getElementById('cpuTemperatureThreshold') as HTMLInputElement).addEventListener('change', (e) => {
        const newValue = (e.target as HTMLInputElement).value;
        const currentValue = vm.cpuTemperatureThreshold;
        // Only update if value actually changed
        if (Number(newValue) !== currentValue) {
            vm.updatePropertyValueDebounced('CpuTemperatureThreshold', Number(newValue));
        }
    });
    (document.getElementById('cpuLoadThreshold') as HTMLInputElement).addEventListener('change', (e) => {
        const newValue = (e.target as HTMLInputElement).value;
        const currentValue = vm.cpuLoadThreshold;
        // Only update if value actually changed
        if (Number(newValue) !== currentValue) {
            vm.updatePropertyValueDebounced('CpuLoadThreshold', Number(newValue));
        }
    });
    (document.getElementById('cpuLoadTimeSpan') as HTMLInputElement).addEventListener('change', (e) => {
        const newValue = (e.target as HTMLInputElement).value;
        const currentValue = vm.cpuLoadTimeSpan;
        // Only update if value actually changed
        if (Number(newValue) !== currentValue) {
            vm.updatePropertyValueDebounced('CpuLoadTimeSpan', Number(newValue));
        }
    });
    (document.getElementById('zoneList') as HTMLInputElement).addEventListener('change', (e) => {
        const newValue = (e.target as HTMLInputElement).value;
        const currentValue = vm.zoneList;
        // Only update if value actually changed
       
            vm.updatePropertyValueDebounced('ZoneList', JSON.parse(newValue));
      
    });
    (document.getElementById('testSettings') as HTMLInputElement).addEventListener('change', (e) => {
        const newValue = (e.target as HTMLInputElement).value;
        const currentValue = vm.testSettings;
        // Only update if value actually changed
     
            vm.updatePropertyValueDebounced('TestSettings', JSON.parse(newValue));
        
    });
    (document.getElementById('showDescription') as HTMLInputElement).addEventListener('change', (e) => {
        const newValue = (e.target as HTMLInputElement).value;
        const currentValue = vm.showDescription;
        // Only update if value actually changed
        if (Boolean(newValue.toLowerCase() === 'true') !== currentValue) {
            vm.updatePropertyValueDebounced('ShowDescription', newValue.toLowerCase() === 'true');
        }
    });
    (document.getElementById('showReadme') as HTMLInputElement).addEventListener('change', (e) => {
        const newValue = (e.target as HTMLInputElement).value;
        const currentValue = vm.showReadme;
        // Only update if value actually changed
        if (Boolean(newValue.toLowerCase() === 'true') !== currentValue) {
            vm.updatePropertyValueDebounced('ShowReadme', newValue.toLowerCase() === 'true');
        }
    });
    (document.getElementById('stateChanged-btn') as HTMLButtonElement).addEventListener('click', async () => {
        try {
            await vm.stateChanged(undefined);
        } catch (err) {
            handleError(err, 'Execute StateChanged');
        }
    });
    (document.getElementById('cancelTest-btn') as HTMLButtonElement).addEventListener('click', async () => {
        try {
            await vm.cancelTest();
        } catch (err) {
            handleError(err, 'Execute CancelTest');
        }
    });
});
